# üéØ RogueMagicBox

**CLI professionnel de GitOps pour l'automatisation Workshop ‚Üí GitHub**

[![C++17](https://img.shields.io/badge/C%2B%2B-17-blue.svg)](https://en.cppreference.com/w/cpp/17)
[![CMake](https://img.shields.io/badge/CMake-3.20+-green.svg)](https://cmake.org/)
[![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20Linux-lightgrey.svg)]()
[![License](https://img.shields.io/badge/license-MIT-orange.svg)](LICENSE)
[![CI/CD](https://img.shields.io/badge/CI%2FCD-Complete-success.svg)](docs/CI_CD.md)
[![Docker](https://img.shields.io/badge/Docker-Available-2496ED?logo=docker&logoColor=white)](https://github.com/XxxSamyxxX/RogueMagicBox/pkgs/container/roguebox)
[![SonarCloud](https://img.shields.io/badge/SonarCloud-Integrated-4E9BCD?logo=sonarcloud&logoColor=white)](https://sonarcloud.io/dashboard?id=XxxSamyxxX_RogueMagicBox)

## üìñ Vue d'ensemble

**RogueMagicBox** est un outil CLI complet en C++17 con√ßu pour automatiser la gestion de projets Workshop :

- üîç **Scan** et inventaire intelligent de dossiers
- üîí **D√©tection automatique** de fichiers sensibles (tokens, cl√©s, secrets)
- üåê **Cr√©ation de repos GitHub** (API + gh CLI fallback)
- üöÄ **Push automatis√©** avec chunking pour gros projets
- üìã **Proof of Work** JSON structur√© avec logs d√©taill√©s

### üéØ Cas d'usage principaux

- **Workshops EPSI/√âcoles** : Initialisation rapide de PRA/projets et push GitHub s√©curis√©
- **DevOps/CI** : Automatisation de synchronisation de workspaces vers repos distants
- **Audit & Compliance** : Inventaires JSON horodat√©s avec hashes pour tra√ßabilit√©

---

## ‚ú® Fonctionnalit√©s

### üîç Scan & Analyse

- ‚úÖ Inventaire r√©cursif avec m√©tadonn√©es (size, hash, mtime)
- ‚úÖ Filtrage via `.rogueignore` (patterns glob)
- ‚úÖ D√©tection de secrets (patterns : `token`, `password`, `api_key`, `.env`, etc.)
- ‚úÖ Limite de taille configurable (d√©faut: 50 MB par fichier)
- ‚úÖ Sortie JSON structur√©e

### üåê GitHub Integration

- ‚úÖ Cr√©ation de repos via **GitHub API** (libcurl) ou **gh CLI** (fallback)
- ‚úÖ Support org/user, repos priv√©s/publics
- ‚úÖ Configuration automatique des remotes
- ‚úÖ Authentification via `GITHUB_TOKEN` ou `gh auth`

### üöÄ Git Automation

- ‚úÖ Initialisation repo avec fichiers standards (`.gitignore`, `LICENSE`, `README.md`)
- ‚úÖ Commit s√©mantique automatique avec timestamps
- ‚úÖ **Chunking intelligent** pour repos >100 MB (batches ~50 MB)
- ‚úÖ Skip automatique des fichiers >50 MB avec warnings
- ‚úÖ Gestion idempotente ("nothing to commit" ‚Üí continue push)

### üîí S√©curit√©

- ‚úÖ `.rogueignore` par d√©faut (tokens, cl√©s, secrets, m√©dias lourds)
- ‚úÖ Masquage des secrets dans les logs
- ‚úÖ Warnings sur inclusion de fichiers sensibles
- ‚úÖ Option `--include-secrets` explicite pour forcer (d√©conseill√©)

### üìä Observabilit√©

- ‚úÖ Logs JSON structur√©s (`logs/rogue.log`)
- ‚úÖ Proof of Work Markdown + JSON (`docs/PROOF_OF_WORK.md`)
- ‚úÖ Mode `--dry-run` pour simulation sans effets de bord
- ‚úÖ Codes de sortie standardis√©s pour CI/CD

---

## üöÄ Installation

### Pr√©requis

**Obligatoires** :

- **C++17** compatible compiler (MSVC 17+, GCC 9+, Clang 10+)
- **CMake** 3.20+
- **Git** 2.30+

**Optionnels** :

- **GitHub CLI** (`gh`) : Pour cr√©ation de repos sans token
- **libcurl** : Pour GitHub API (sinon fallback vers gh)

### ü™ü Windows (PowerShell)

```powershell
# 1. Cloner le projet
git clone https://github.com/votre-org/RogueMagicBox.git
cd RogueMagicBox

# 2. Configurer et builder
cmake -S . -B build -G "Visual Studio 17 2022"
cmake --build build --config Release -j 8

# 3. Ex√©cutable disponible
.\build\Release\roguebox.exe --help
```

### üêß Linux / macOS

```bash
# 1. Cloner
git clone https://github.com/votre-org/RogueMagicBox.git
cd RogueMagicBox

# 2. Installer d√©pendances (Ubuntu/Debian)
sudo apt update
sudo apt install -y build-essential cmake git libcurl4-openssl-dev

# 3. Builder
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build -j $(nproc)

# 4. Ex√©cutable
./build/roguebox --help
```

### üì¶ Installation syst√®me (optionnel)

```bash
# Linux/macOS
sudo cmake --install build

# Windows (Admin PowerShell)
cmake --install build --prefix "C:\Program Files\RogueMagicBox"
```

---

## üéØ Utilisation Rapide

### 1Ô∏è‚É£ Scan d'un dossier Workshop

```powershell
roguebox.exe scan --root "C:\Workshop\PRA"
```

**Sortie** :

```json
{
  "files": [
    {
      "path": "README.md",
      "size": 1234,
      "hash": "abc...",
      "mtime": "2025-10-15T10:00:00"
    },
    {
      "path": "src/main.cpp",
      "size": 5678,
      "hash": "def...",
      "mtime": "2025-10-15T09:30:00"
    }
  ],
  "total_size": 45678,
  "generated_at": "2025-10-15T11:00:00",
  "root": "C:\\Workshop\\PRA"
}
```

### 2Ô∏è‚É£ Initialiser Git + GitHub

```powershell
roguebox.exe init-repo `
  --root "C:\Workshop\PRA" `
  --repo-name "epsi-pra-2025" `
  --private `
  --org "MonEcole"
```

**R√©sultat** :

- ‚úÖ Repo Git local cr√©√©
- ‚úÖ Fichiers `.gitignore`, `.rogueignore`, `LICENSE`, `README.md` g√©n√©r√©s
- ‚úÖ Repo GitHub `MonEcole/epsi-pra-2025` (priv√©) cr√©√©
- ‚úÖ Remote `origin` configur√©

### 3Ô∏è‚É£ Commit & Push

```powershell
roguebox.exe push-all --root "C:\Workshop\PRA"
```

**Actions** :

- `git add -A`
- `git commit -m "chore(import): add Workshop sources & docs (2025-10-15)"`
- `git push -u origin main`

### 4Ô∏è‚É£ Pipeline complet (Recommand√© ‚≠ê)

```powershell
roguebox.exe full-run `
  --root "C:\Workshop\PRA" `
  --repo-name "epsi-pra-final" `
  --private `
  --org "MonEcole"
```

**√âtapes automatis√©es** :

1. üîç Scan + inventaire JSON
2. üìÅ Init repo local + standards
3. üåê Cr√©ation repo GitHub
4. üîó Configuration remote
5. üì¶ Commit de tout
6. üöÄ Push vers GitHub
7. üìù G√©n√©ration `docs/PROOF_OF_WORK.md`

---

## üìö Documentation Compl√®te

- üìñ **[Guide Utilisateur](docs/USER_GUIDE.md)** : Toutes les commandes d√©taill√©es
- üèóÔ∏è **[Architecture](docs/ARCHITECTURE.md)** : Design interne, modules, API
- ‚öôÔ∏è **[Configuration](docs/CONFIGURATION.md)** : Options avanc√©es, fichiers config
- üí° **[Exemples](docs/USAGE.md)** : Cas d'usage r√©els avec screenshots
- üîß **[D√©veloppement](docs/DEVELOPMENT.md)** : Build, tests, contribution

---

## üîß Commandes CLI

### `scan` - Analyse de dossier

```bash
roguebox scan --root <path> [OPTIONS]
```

**Options** :

- `--include <glob>` : Pattern d'inclusion (r√©p√©table)
- `--exclude <glob>` : Pattern d'exclusion (r√©p√©table)
- `--max-size-mb <int>` : Taille max fichier (d√©faut: 50)
- `--include-secrets` : Force inclusion de secrets (‚ö†Ô∏è)
- `--dry-run` : Simulation sans sortie fichier

**Exemple** :

```powershell
roguebox scan --root ".\src" --exclude "*.log" --exclude "node_modules" --max-size-mb 100
```

---

### `init-repo` - Initialisation Git/GitHub

```bash
roguebox init-repo --root <path> --repo-name <name> [OPTIONS]
```

**Options** :

- `--org <org>` : Organisation GitHub (d√©faut: user)
- `--private` : Repo priv√© (d√©faut)
- `--public` : Repo public
- `--no-remote` : Skip cr√©ation GitHub (local seulement)
- `--dry-run` : Affiche plan sans ex√©cution

**Exemples** :

```powershell
# Repo priv√© d'org
roguebox init-repo --root ".\PRA" --repo-name "pra-2025" --private --org "EPSI"

# Repo public personnel
roguebox init-repo --root ".\projet" --repo-name "mon-projet" --public

# Local seulement
roguebox init-repo --root ".\test" --repo-name "local-test" --no-remote
```

---

### `push-all` - Commit & Push

```bash
roguebox push-all --root <path> [OPTIONS]
```

**Options** :

- `--branch <name>` : Branche cible (d√©faut: main)
- `--commit-message "<msg>"` : Message personnalis√©
- `--dry-run` : Affiche plan (single/chunked)

**Exemples** :

```powershell
# Push simple
roguebox push-all --root ".\PRA"

# Push avec message custom
roguebox push-all --root ".\projet" --commit-message "feat: add authentication module"

# Push sur branche dev
roguebox push-all --root ".\projet" --branch "dev"
```

---

### `full-run` - Pipeline complet

```bash
roguebox full-run --root <path> --repo-name <name> [OPTIONS]
```

**Options** : Combine toutes les options de `init-repo` et `push-all`

**Exemple complet** :

```powershell
roguebox full-run `
  --root "C:\Users\User\Workshop\PRA" `
  --repo-name "epsi-pra-i2-2025" `
  --private `
  --org "EPSI-Cyber" `
  --branch "main" `
  --max-size-mb 50
```

---

## üîí S√©curit√© & Best Practices

### üõ°Ô∏è Fichiers ignor√©s par d√©faut (`.rogueignore`)

```
# Cl√©s et secrets
*.key
*.pem
*.pfx
*.p12
*.kdbx
.env
.env.*
id_*
*token*
*secret*
*password*

# Archives lourdes
*.iso
*.zip
*.tar.gz
*.7z
*.rar

# M√©dias
*.mp4
*.mov
*.avi
*.mkv
```

### üìã Checklist avant push

- [ ] Aucun fichier `.env` ou token dans le code
- [ ] V√©rifier `scan --dry-run` pour d√©tection secrets
- [ ] `.rogueignore` personnalis√© si besoins sp√©cifiques
- [ ] Tester avec `--dry-run` avant ex√©cution r√©elle
- [ ] Repos sensibles ‚Üí toujours `--private`

### üîê Authentification GitHub

**Option 1 : GitHub CLI (Recommand√©)**

```powershell
gh auth login
# Suivre le flow web
```

**Option 2 : Token d'acc√®s personnel**

```powershell
# Windows
$env:GITHUB_TOKEN="ghp_votretoken..."

# Linux/macOS
export GITHUB_TOKEN="ghp_votretoken..."
```

**Permissions requises** :

- `repo` (cr√©ation repos)
- `read:org` (si utilisation `--org`)

---

## üìä Logs & Observabilit√©

### Logs JSON structur√©s

**Emplacement** : `logs/rogue.log`

**Format** :

```json
{"ctx":"init-repo","level":"info","msg":"Repo created via gh CLI","ts":"2025-10-15T11:03:00"}
{"ctx":"push-all","level":"warn","msg":"Commit failed (possibly nothing to commit); will attempt push anyway","ts":"2025-10-15T11:03:01"}
{"ctx":"git","level":"error","msg":"non-zero exit","code":"128","ts":"2025-10-15T11:03:02"}
```

### Proof of Work

**Emplacement** : `docs/PROOF_OF_WORK.md`

**Contenu** :

- Timestamp de g√©n√©ration
- Inventaire JSON complet des fichiers
- Hash de chaque fichier (d√©monstration via `std::hash`)
- Total size du workspace

**Exemple** :

````markdown
# PROOF OF WORK

Generated at: 2025-10-15T11:03:00

## Inventory

```json
{
  "files": [...],
  "total_size": 66446,
  "generated_at": "2025-10-15T11:03:00",
  "root": "C:\\Workshop\\PRA"
}
```
````

---

## üß™ Tests

### Ex√©cuter les tests

```bash
# Configuration et build
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build -j 8

# Ex√©cuter les tests
cd build
ctest -C Release --output-on-failure
```

**Tests inclus** :

- ‚úÖ Scanner (patterns, ignore, tailles)
- ‚úÖ GitOps (init, remote, commit)
- ‚úÖ Config parser (TOML basique)

---

## üèóÔ∏è Architecture

```
RogueMagicBox/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp              # CLI entry point
‚îÇ   ‚îú‚îÄ‚îÄ cli/                  # Command handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ args.hpp          # CLI argument parsing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands_scan.cpp
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands_init.cpp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands_push.cpp
‚îÇ   ‚îî‚îÄ‚îÄ core/                 # Business logic
‚îÇ       ‚îú‚îÄ‚îÄ scanner.cpp       # Workspace scanning
‚îÇ       ‚îú‚îÄ‚îÄ gitops.cpp        # Git operations
‚îÇ       ‚îú‚îÄ‚îÄ github_api.cpp    # GitHub API/CLI
‚îÇ       ‚îú‚îÄ‚îÄ logger.cpp        # JSON logging
‚îÇ       ‚îú‚îÄ‚îÄ config.cpp        # Config parser
‚îÇ       ‚îî‚îÄ‚îÄ utils.cpp         # Helpers
‚îú‚îÄ‚îÄ include/rogue/            # Public headers
‚îú‚îÄ‚îÄ tests/                    # Unit tests
‚îú‚îÄ‚îÄ docs/                     # Documentation
‚îú‚îÄ‚îÄ scripts/                  # Install/demo scripts
‚îî‚îÄ‚îÄ third_party/              # Vendored deps (JSON, Catch2 shim)
```

**Modules cl√©s** :

- **Scanner** : Parcours r√©cursif, filtres, m√©tadonn√©es
- **GitOps** : Abstraction Git (`git -C` pour portabilit√©)
- **GitHubApi** : Cr√©ation repos (libcurl ‚Üí gh fallback)
- **Logger** : Logs JSON structur√©s avec masquage secrets

---

## üõ†Ô∏è Build depuis les sources

### Options CMake

```bash
cmake -S . -B build \
  -DCMAKE_BUILD_TYPE=Release \
  -DBUILD_TESTS=ON \
  -DCMAKE_INSTALL_PREFIX=/usr/local
```

**Variables** :

- `CMAKE_BUILD_TYPE` : `Debug`, `Release`, `RelWithDebInfo`
- `BUILD_TESTS` : `ON`/`OFF` (d√©faut: `ON`)
- `HAVE_LIBCURL` : Auto-d√©tect√© (si pr√©sent ‚Üí GitHub API)

### Packaging

```bash
# G√©n√©rer archive distributable
cmake --build build --target package

# R√©sultat: RogueMagicBox-1.0.0-win64.zip (ou .tar.gz)
```

---

## üöÄ CI/CD Pipeline

RogueMagicBox impl√©mente une **pipeline CI/CD compl√®te** conforme au d√©fi **"CI/CD Express voie 93‚ÅÑ4"** :

‚úÖ **Tests unitaires** (Catch2)  
‚úÖ **Tests de non-r√©gression** (E2E automatis√©s)  
‚úÖ **V√©rification norme de code** (clang-format, clang-tidy)  
‚úÖ **Build & test image Docker** (multi-stage Alpine)  
‚úÖ **Analyse SonarCloud** (qualit√©, s√©curit√©, dette technique)  
‚úÖ **D√©ploiement automatique** (GitHub Releases + Docker Registry)

**Documentation compl√®te** : [docs/CI_CD.md](docs/CI_CD.md)

### üê≥ Utilisation Docker

```bash
# Pull depuis GitHub Container Registry
docker pull ghcr.io/xxxsamyxxx/roguebox:latest

# Scan d'un workspace
docker run --rm -v $(pwd):/workspace \
  ghcr.io/xxxsamyxxx/roguebox:latest \
  scan --root /workspace --dry-run

# Full-run avec GitHub auth
docker run --rm -v $(pwd):/workspace \
  -e GITHUB_TOKEN=$GITHUB_TOKEN \
  ghcr.io/xxxsamyxxx/roguebox:latest \
  full-run --root /workspace --repo-name "my-project" --private
```

---

## ü§ù Contribution

Les contributions sont bienvenues ! Veuillez :

1. Fork le projet
2. Cr√©er une branche feature (`git checkout -b feature/amazing`)
3. Commit avec messages s√©mantiques (`git commit -m 'feat: add X'`)
4. Push vers la branche (`git push origin feature/amazing`)
5. Ouvrir une Pull Request

**Guidelines** :

- Suivre C++17 best practices
- Ajouter tests pour nouvelles features
- Mettre √† jour la documentation
- Respecter le style existant (clang-format)

---

## üìÑ Licence

MIT License - voir [LICENSE](LICENSE)

Copyright (c) 2025 RogueMagicBox Contributors

---

## üôè Remerciements

- **nlohmann/json** : JSON library (vendored minimal shim)
- **Catch2** : Test framework (shim inclus)
- **GitHub CLI** : Fallback pour cr√©ation repos
- Communaut√© C++ pour les best practices

---

## üìû Support

- üêõ **Issues** : [GitHub Issues](https://github.com/votre-org/RogueMagicBox/issues)
- üí¨ **Discussions** : [GitHub Discussions](https://github.com/votre-org/RogueMagicBox/discussions)
- üìß **Email** : support@roguebox.dev

---

**Made with ‚ù§Ô∏è for Workshop automation**
